<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Learn Git with beginner to advanced Git tutorials on workflows, git commands, git migration and code review.">
<meta name="author" content="Atlassian">
<link rel="canonical" href="https://www.atlassian.com/git"/>
<title>Kikaha documentation</title>
<link rel="stylesheet" href="site.css"/>
<link href="https://fonts.googleapis.com/css?family=Sanchez:200,300,400,600" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
<script src="showdown.min.js">
<script src="showdown-github.min.js">
<script>

</script>
</head>
<body class="wac git-home git">
<div class="header">
  <div class="container">
    <span class="k">k</span>
    <h1>Kikaha</h1>
    <a href="https://blog.kikaha.io">blog</a>
    <a href="https://github.com/Skullabs/kikaha">source code</a>
  </div>
</div>

<div class="page-wrap">
<div class="home-section home-about home-start">
<div class="g-row container">

<div class="g-column g-7-12 t-6-12 m-12-12">
<!-- CONTENT -->
<h1 id="websocketrouting">WebSocket Routing</h1>
<p>WebSocket is a protocol providing full-duplex communication channels over a single TCP connection. The WebSocket protocol was standardized by the IETF as RFC 6455 in 2011, and the WebSocket API in Web IDL is being standardized by the W3C. Undertow provides support for Websockets out of the box. Undertow core provides a XNIO based API, which uses the Xnio Channel interface to provide access to the web socket at a low level.</p>
<p>Most users will want a higher level interface than this and Undertow provides a JSR-356 implementation through the <code>undertow-websocket-jsr</code>. It is quite useful and has awesome performance, but it stills depends on <strong><a href="http://www.javatpoint.com/servlet-api">Servlet API</a></strong>. As Servlet containers hurts <strong><a href="doc:kikaha-philosophy.html">Kikaha's philosophy</a></strong> due to its <strong><a href="http://blog.lunatech.com/2011/12/08/wrong-with-servlet-api">complexity</a></strong>, micro Routing API also offers a tiny layer for dealing with Web Socket Resources.</p>
<blockquote>
  <p>Note: to use WebSocket routing be sure to include the <a href="doc:urouting-api.html">uRouting API</a> dependency on your project.</p>
</blockquote>
<h2 id="creatingmyfirstfirstwebsocketendpoint">Creating my first first web socket endpoint</h2>
<p>The bellow sample shows how to listen to messages sent in a chat room.</p>
<pre><code class="java language-java">import kikaha.urouting.api.*;

@WebSocket( "chat/{room-id}" )
public class ChatResource {

    @OnMessage
    public void onMessage(
        @PathParam("room-id") final Long id,
        final String message ) {
        System.out.println( id + ":" + message );
    }
}
</code></pre>
<h4 id="notes">Notes:</h4>
<ul>
<li>The string object <em>message</em> is the message received from the WebSocket client</li>
<li>The Long object <em>id</em> was extracted from URI path, once it is annotated with <code>@PathParam</code> annotation</li>
<li>It is also possible to extract data from Headers using the <code>@HeaderParam</code> annotation the same way you use for other <strong><a href="doc:urouting-api.html">ordinary HTTP requests</a></strong>.</li>
</ul>
<h2 id="listeningtothewebsocketevents">Listening to the Web Socket events</h2>
<p>Similarly to JSR-356, you are able to listen to any web socket events (<code>on error</code>, <code>on open</code> and <code>on close</code>) using annotations.</p>
<pre><code class="java language-java">import io.undertow.websockets.core.CloseMessage;
import kikaha.urouting.api.*;

@WebSocket( "chat/{room-id}" )
public class ChatResource {

    @OnOpen
    public void onOpen(
        @HeaderParam( "SESSION" ) final String sessionId ) {
        System.out.println( sessionId );
    }

    @OnError
    public void onError( final Throwable cause ) {
        System.err.println( cause.getMessage() );
    }

    @OnClose
    public void onClose( final CloseMessage cm ) {
        System.out.println( cm.getReason() );
    }
}
</code></pre>
<h2 id="sendingmessagestootherpeers">Sending messages to other peers</h2>
<p>Kikaha wrapped the Undertow WebSocket session in a <code>WebSocketSession</code> instance. This session instance is able to send messages to other peers, or even broadcast message to them. You can inject the  a <code>WebSocketSession</code> instance wherever the event method you need.</p>
<pre><code class="java language-java">import io.undertow.websockets.core.CloseMessage;
import kikaha.core.modules.websocket.WebSocketSession;
import kikaha.urouting.api.*;

@WebSocket( "chat/{room-id}" )
public class ChatResource {

    @OnMessage
    public void onMessage( WebSocketSession session, String message ) {
        session.broadcast( session.userPrincipal() + " just sent: " + message );
    }

    @OnOpen
    public void onOpen( WebSocketSession session ) {
        session.broadcast( session.userPrincipal() + " has entered into the chat room" );
    }

    @OnError
    public void onError( final Throwable cause ) {
        System.err.println( cause.getMessage() );
    }

    @OnClose
    public void onClose( WebSocketSession session, CloseMessage cm ) {
        session.broadcast( session.userPrincipal() + " left the chat room" );
    }
}
</code></pre>
<p>A brief description of some methods available on WebSocketSession:</p>
<ul>
<li>WebSocketSession.broadcast - sends messages to every peer on the same "room"</li>
<li>WebSocketSession.send( "message" ).to( peer ) - sends messages to a specific peer</li>
<li>WebSocketSession.getUserPrincipal() - returns the current logged in used</li>
<li>WebSocketSession.getRequestHeaders() - returns all headers sent by the request</li>
<li>WebSocketSession.getRequestParameters() - returns all parameters sent by the request</li>
</ul>
</div>

<div class="g-column g-4-12 t-6-12 m-12-12">
<div class="home-about--git-download-block">
<h3>Welcome</h3>
<!-- SIDE BAR -->
<p>WELCOME
<a href="About-kikaha.html">About</a>
<a href="Kikaha-Philosophy.html">Kikaha philosophy</a></p>
<p>GETTING STARTED
<a href="Getting-Started-in-1-Minute.html">Getting started in 1 minute</a>
<a href="Creating-a-Kikaha-maven-project.html">Creating a Kikaha maven project</a>
<a href="Logging-Configuration.html">Logging configuration</a>
<a href="Architecture-Overview.html">Architecture overview</a>
<a href="Configuring-the-server.html">Configuring the server</a></p>
<p>CORE FEATURES
<a href="HTTP-and-HTTPS.html">HTTP and HTTPS</a>
<a href="Routing-static-assets.html">Routing static assets</a>
<a href="Dependency-Injection.html">Dependency injection</a>
<a href="Authentication-and-Authorization.html">Authentication and authorization</a>
<a href="Smart-Routes.html">Smart routes</a></p>
<p>ESSENTIAL MODULES
<a href="uRouting-API.html">μRouting API</a>
<a href="Web-Socket-routing.html">WebSocket Routing</a>
<a href="Database-Access.html">Database Connection Pool</a>
<a href="JSON-with-Jackson.html">JSON with Jackson</a>
<a href="Proto-Buffers.html">Protobuf</a>
<a href="Mustache.html">Mustache Templates</a>
<a href="Rocker-Templates.html">Rocker Templates</a>
<a href="BCrypt.html">BCrypt</a></p>
<p>CLOUD MODULES
<a href="Consul.io.html">Consul.io</a>
<a href="Codahale-Metrics.html">Codahale's Metrics</a>
<a href="Auth0.html">Auth0 Single Sign-On</a>
<a href="uWorkers.html">μWorkers - Actor-like API</a>
<a href="Hazelcast.html">Hazelcast</a></p>
<p>AWS-RELATED MODULES
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+IAM+Credentials&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+IAM+Credentials..html">AWS IAM Credentials</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+EC2&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+EC2..html">AWS EC2</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+SQS+Queues&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+SQS+Queues..html">AWS SQS queues</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+CloudWatch+Metrics&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+CloudWatch+Metrics..html">AWS CloudWatch metrics</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+ALB&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+Load+Balacer..html">AWS Application Load Balancer</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+Lambda&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+Lambda+Functions..html">AWS Lambda functions</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+X-RAY&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+X-RAY..html">AWS X-Ray</a></p>
<p>TUTORIALS
<a href="creating-your-first-http-route.html">Creating your first HTTP route</a>
<a href="kikahas-command-line-interface-tool.html">Kikaha's command line interface</a>
<a href="configuring-your-favorite-ide.html">Configuring your favorite IDE</a>
<a href="Kikaha-Wro4j-Integration.html">Wro4j Integration</a></p>
<p>ADVANCED TOPICS
<a href="Creating-Custom-Modules.html">Creating custom modules</a>
<a href="Routing-With-Undertow.html">Routing with Undertow's API</a>
<a href="Creating-Custom-Cloud-Modules.html">Creating custom cloud modules</a></p>
</div>
</div>

</div>
</div>
</div>
</body>
</html>
