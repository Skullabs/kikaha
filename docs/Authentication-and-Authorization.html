<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Learn Git with beginner to advanced Git tutorials on workflows, git commands, git migration and code review.">
<meta name="author" content="Atlassian">
<link rel="canonical" href="https://www.atlassian.com/git"/>
<title>Kikaha documentation</title>
<link rel="stylesheet" href="site.css"/>
<link href="https://fonts.googleapis.com/css?family=Sanchez:200,300,400,600" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
<script src="showdown.min.js">
<script src="showdown-github.min.js">
<script>

</script>
</head>
<body class="wac git-home git">
<div class="header">
  <div class="container">
    <span class="k">k</span>
    <h1>Kikaha</h1>
    <a href="https://blog.kikaha.io">blog</a>
    <a href="https://github.com/Skullabs/kikaha">source code</a>
  </div>
</div>

<div class="page-wrap">
<div class="home-section home-about home-start">
<div class="g-row container">

<div class="g-column g-7-12 t-6-12 m-12-12">
<!-- CONTENT -->
<p>Kikaha has a very tiny and non-intrusive Security API written over Undertow's Security API. Basically it has a few components that together allow you to protect your resources. Let's checkout the main components you'll usually need to deal with:</p>
<ul>
<li><em>Authentication Rules</em>: will define how your web resources will be protected against unauthorized access.</li>
<li><em>Authentication Mechanisms</em>: defines how to extract credentials from the request when trying to authenticate.</li>
<li><em>Identity Manager</em>: defines how to check if found credentials are valid.</li>
<li><em>Session Store</em>: defines how to sessions are managed on the server.</li>
<li><em>Password Encoder</em>: defines how passwords are stored and matched.</li>
</ul>
<h2 id="authenticationmechanisms">Authentication Mechanisms</h2>
<p>Authentication mechanisms is responsible for extract credentials from HTTP requests. Usually they does not check if the credentials are valid, but delegates the validation to the IdentityManager defined on the matched Authentication Rule. Out-of-box only a few Authentication Mechanisms are provided. They are very common and allow developers to get started very quickly. Bellow they are listed and identified by its own <code>alias</code>:</p>
<ul>
<li><em>basic</em>: The implementation of Http's Basic Authentication.</li>
<li><em>form</em>: The Form-based authentication. It will enforce security by requiring user to provide their credentials through a HTML form.</li>
<li><em>json</em>: Will receive the credentials through a HTTP POST of a JSON object. This mechanism requires <a href="https://github.com/Skullabs/kikaha/tree/master/kikaha-modules/kikaha-jackson">kikaha-jackson</a> module.</li>
<li><em>default</em>: Points to the "basic" one.</li>
</ul>
<p>Now lets talk about its <em>alias</em>. All Authentication Mechanism should be defined on the configuration entry <code>server.auth.authentication-mechanisms</code> on a <code>alias: class.Name</code> form (see sample the configuration file bellow). The alias, as we discussed before, are used on the Authentication Rules and avoids you to repeat the Authentication Mechanism's Class Canonical Name every time you need to use it to protect a specific resource.</p>
<p>Here are a sample code with the default Authentication Mechanisms that comes out-of-box with Kikaha:</p>
<pre><code class="yml language-yml">server:
  auth:
    auth-mechanisms:

      # available on kikaha-core's module
      default: kikaha.core.modules.security.BasicAuthenticationMechanism
      basic: kikaha.core.modules.security.BasicAuthenticationMechanism
      form: kikaha.core.modules.security.FormAuthenticationMechanism

      # available on kikaha-jackson's module
      json: kikaha.urouting.serializers.jackson.JSONAuthenticationMechanism
</code></pre>
<p>If none of the above described mechanisms fits your needs you can easily create your own by implementing the interface <code>kikaha.core.modules.security.AuthenticationMechanism</code> and defining an alias for it. Please, keep in mind that cood Authentication Mechanisms usually delegates the Credential Validation to a proper IdentityManager.</p>
<h2 id="identitymanagers">Identity Managers</h2>
<p>Identity Managers are responsible for ensure credentials are valid. It is also responsible to retrieve the <code>Account</code> and its <code>Roles</code> from the place you've stored your data. Out-of-box there a few Identity Managers available:</p>
<ul>
<li><em>fixed</em>: Uses a fixed username and password, defined on the configuration file, as the only valid credential</li>
<li><em>db-auth</em>: Uses a Database connection to validate credentials.</li>
<li><em>default</em>: Points to the "fixed" one.</li>
</ul>
<h3 id="customidentitymanager">Custom Identity Manager</h3>
<p>A more sophisticated Identity Manager could be developed by implementing the <code>kikaha.core.modules.security.IdentityManager</code> interface. A much simpler approach is to extends <code>kikaha.core.modules.security.AbstractPasswordBasedIdentityManager</code>.</p>
<p>The code bellow illustrates how to create your own Identity Manager with fixed username and password. Developers are encouraged to follow this pattern to provide their own Identity Manager.</p>
<pre><code class="java language-java">package sample;
import kikaha.core.modules.security.*;

public class CustomIdentityManager extends AbstractPasswordBasedIdentityManager {

    final String username = "admin";
    final String password = "password";
    final String defaultRole = "admin";

    @Override
    public Account retrieveAccountFor( String id, String password ) {
        if ( this.username.equals( id ) &amp;&amp; this.password.equals( password ) )
            return new FixedUsernameAndRolesAccount( username, defaultRole );
        return null;
    }
}
</code></pre>
<p>Don't forget to register an alias to your custom Identity Manager.</p>
<pre><code class="yml language-yml">server:
  auth:
    identity-manager:
      custom: sample.CustomIdentityManager
</code></pre>
<h2 id="passwordencoders">Password Encoders</h2>
<p>Whenever you need to handle how to store or match a password you can use a Password Encoder to keep you credentials safe. Basically, out-of-box, there are two password encoders available:</p>
<ul>
<li>plain-text: Keep your password as is. This is the default one. Class: <code>kikaha.core.modules.security.PlainTextPasswordEncoder</code></li>
<li>bcrypt: uses BCrypt to protect your password. Class: 'kikaha.bcrypt.BCryptPasswordEncoder'</li>
</ul>
<p>You can define which Password Encoder will be used on your application by simply pointing the configuration entry <code>server.auth.password-encoder</code> to one of above mentioned classes.</p>
<pre><code class="yml language-yml">server:
  auth:
    password-encoder: kikaha.core.modules.security.PlainTextPasswordEncoder
</code></pre>
<h2 id="authenticationrules">Authentication Rules</h2>
<p>In order to protect your resources and forces the authentication process you should include an entry in <code>server.auth.rules</code> array on your configuration file. It will behaves like <a href="http://en.wikipedia.org/wiki/Access_control_list">ACL</a> where the first rule that matches the request will be applied. If no rule was matched, then the route will be executed as non-authenticated resource. Bellow we defined a rule the require authentication for any request made at "/protected/" resource and its sub-locations.</p>
<pre><code class="yml language-yml">server:
  auth:
    rules:
      - pattern: "/protected/*"
        identity-manager: ["custom"]
        auth-mechanisms: ["basic"]
        expected-roles: []
        exclude-patterns: [ "*.ico","*.js" ]
</code></pre>
<p>As you can note, there is some attributes we can define for each rule:</p>
<ul>
<li>pattern: the unique mandatory attribute, it defines which resources will require authentication</li>
<li>identity-manager: (optional) defines which Identity Manager will be used to match the sent credentials. If not define, the "default" one will be used.</li>
<li>mechanisms: (optional) defines which Authentication Mechanisms will used to extract credentials. If not define, the "default" one will be used.</li>
<li>expected-roles: (optional) which roles should the Identity Manager retrieves to authorize the access to resources protected by this rule. Empty value means no specific roles are actually required to execute this resource.</li>
<li>exclude-patterns: (optional) is an array of patters that should ignored during the authorization/authentication process. There is cases where is easier to map a more generalist pattern and define which URLs should be unconsidered on the authentication/authorization process. It may be also useful when you have more than one authentication rule.</li>
</ul>
<p>If for some reason you have to repeat some exclusion-patterns on every rule you made, you rather define then at <code>server.auth.default-excluded-patterns</code>.</p>
<p>Also, you can simplify your configuration file by overriding the 'default' <code>identity-manager</code> and <code>authentication-mechanism</code>. Bellow a more usual authentication rules should look like.</p>
<pre><code class="yml language-yml">server:
  auth:
    # Using my custom
    identity-manager: { default: sample.CustomIdentityManager }
    default-excluded-patterns: ["*.ico","*.css","*.js","*.png","*.jpg"]
    rules:
      # Any logged in user will be able to enter most part of the system
      - { pattern: "/*", auth-mechanisms: ["basic","form"], exclude-patterns: ["/api/admin/*"] }
      # Only administrators are allowed to access /api/admin/*
      - { pattern: "/api/admin/*", auth-mechanisms: ["basic"], expected-roles: ["ADMIN"] }
</code></pre>
<h2 id="sessionstore">Session Store</h2>
<p><code>TODO</code></p>
<h2 id="configuringthefixeduserandpasswordidentitymanager">Configuring the Fixed User and Password Identity Manager</h2>
<p>If you opt to use the <em>Fixed User and Password Identity Manager</em>, you can set the expected username, password and role at <code>server.auth.fixed-auth</code> entry of your configuration file. You can find the default values <a href="doc:configuring-the-server.html">here</a>.</p>
<pre><code class="yml language-yml">server:
  auth:
    fixed-auth:
      username: "admin"
      password: "admin"
      role: "admin"
</code></pre>
<h2 id="configuringtheformauthenticationmechanism">Configuring the Form Authentication Mechanism</h2>
<p>Consider the bellow configuration.</p>
<pre><code class="yml language-yml">server:
  auth:
    rules:
      - { pattern: "/protected/*", auth-'mechanisms: ["form"] }

    fixed-auth:
      username: "admin"
      password: "1q2w3e"
      role: "admin"

    endpoints:
      login-page: "/auth/login.html"
      error-page: "/auth/error.html"
      permission-denied-page: "/auth/forbiden.html"
      callback-url: "/auth/callback"
</code></pre>
<p>Here we've defined a set of configuration parameters related to Form Authentication. At the first block we which resources will be required authorization to access. Besides is impossible to set more than one Authentication Mechanism at once, we set only "form" to simplify our example.</p>
<p>As we defined the "default" identity-manager as our mechanism to validate the credentials sent by the HTTP client, we defined the username and password at the <code>fixed-auth</code> block. The last block, <code>form-auth</code> define which pages will be used during the authentication lifecycle:</p>
<ul>
<li><strong>login-page</strong>: the HTML page containing the form where users will be able to write its credentials</li>
<li><strong>error-page</strong>: the HTML page that will notify the user the logging have failed</li>
<li><strong>permission-defined-page</strong>: the HTML page the will notify the user the login was OK but he does not have permission (specific roles) to access the requested page.</li>
</ul>
<pre><code class="html language-html">&lt;!-- http://www.avajava.com/tutorials/lessons/how-do-i-use-form-authentication-with-tomcat.html --&gt;
&lt;form method="POST" action="/protected/j_security_check"&gt;
&lt;table&gt;
  &lt;tr&gt;
    &lt;td colspan="2"&gt;Login to the Demo application:&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Name:&lt;/td&gt;
    &lt;td&gt;&lt;input type="text" name="j_username" /&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Password:&lt;/td&gt;
    &lt;td&gt;&lt;input type="password" name="j_password"/ &gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td colspan="2"&gt;&lt;input type="submit" value="Go" /&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;/form&gt;
</code></pre>
<p>Above a sample <code>login.html</code>. Java developers will be at home here once it follows the same standard for form authentication defined by Servlet API:</p>
<ul>
<li>The action must match the callback URL above defined</li>
<li>The username field must be named <em>j_username</em> </li>
<li>The password field must be named <em>j_password</em>.</li>
</ul>
</div>

<div class="g-column g-4-12 t-6-12 m-12-12">
<div class="home-about--git-download-block">
<h3>Welcome</h3>
<!-- SIDE BAR -->
<p>WELCOME
<a href="About-kikaha.html">About</a>
<a href="Kikaha-Philosophy.html">Kikaha philosophy</a></p>
<p>GETTING STARTED
<a href="Getting-Started-in-1-Minute.html">Getting started in 1 minute</a>
<a href="Creating-a-Kikaha-maven-project.html">Creating a Kikaha maven project</a>
<a href="Architecture-Overview.html">Architecture overview</a></p>
<p>TUTORIALS
<a href="Logging-Configuration.html">Logging configuration</a>
<a href="Configuring-the-server.html">Configuring the server</a>
<a href="creating-your-first-http-route.html">Creating your first HTTP route</a>
<a href="kikahas-command-line-interface-tool.html">Kikaha's command line interface</a>
<a href="configuring-your-favorite-ide.html">Configuring your favorite IDE</a>
<a href="Kikaha-Wro4j-Integration.html">Wro4j Integration</a></p>
<p>CORE FEATURES
<a href="HTTP-and-HTTPS.html">HTTP and HTTPS</a>
<a href="Routing-static-assets.html">Routing static assets</a>
<a href="Dependency-Injection.html">Dependency injection</a>
<a href="Authentication-and-Authorization.html">Authentication and authorization</a>
<a href="Smart-Routes.html">Smart routes</a></p>
<p>ESSENTIAL MODULES
<a href="uRouting-API.html">μRouting API</a>
<a href="Web-Socket-routing.html">WebSocket Routing</a>
<a href="Database-Access.html">Database Connection Pool</a>
<a href="JSON-with-Jackson.html">JSON with Jackson</a>
<a href="Proto-Buffers.html">Protobuf</a>
<a href="Mustache.html">Mustache Templates</a>
<a href="Rocker-Templates.html">Rocker Templates</a>
<a href="BCrypt.html">BCrypt</a></p>
<p>CLOUD MODULES
<a href="Overview-of-Cloud-Module.html">Overview of Cloud Modules</a>
<a href="Consul.io.html">Consul.io</a>
<a href="Codahale-Metrics.html">Codahale's Metrics</a>
<a href="Auth0.html">Auth0 Single Sign-On</a>
<a href="uWorkers.html">μWorkers - Actor-like API</a>
<a href="Hazelcast.html">Hazelcast</a></p>
<p>AWS-RELATED MODULES
<a href="AWS-Related-Modules.html">Overview of AWS-Related Modules</a>
<a href="Deploying-Applications-to-AWS.html">Deploying Applications on AWS</a>
<a href="AWS-IAM-Credentials.html">AWS IAM Credentials</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+EC2&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+EC2..html">AWS EC2</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+SQS+Queues&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+SQS+Queues..html">AWS SQS queues</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+CloudWatch+Metrics&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+CloudWatch+Metrics..html">AWS CloudWatch metrics</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+ALB&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+Load+Balacer..html">AWS Application Load Balancer</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+Lambda&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+Lambda+Functions..html">AWS Lambda functions</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+X-RAY&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+X-RAY..html">AWS X-Ray</a></p>
<p>ADVANCED TOPICS
<a href="Creating-Custom-Modules.html">Creating custom modules</a>
<a href="Routing-With-Undertow.html">Routing with Undertow's API</a>
<a href="Creating-Custom-Cloud-Modules.html">Creating custom cloud modules</a></p>
</div>
</div>

</div>
</div>
</div>
</body>
</html>
