<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Learn Git with beginner to advanced Git tutorials on workflows, git commands, git migration and code review.">
<meta name="author" content="Atlassian">
<link rel="canonical" href="https://www.atlassian.com/git"/>
<title>Kikaha documentation</title>
<link rel="stylesheet" href="site.css"/>
<link href="https://fonts.googleapis.com/css?family=Sanchez:200,300,400,600" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
<script src="showdown.min.js">
<script src="showdown-github.min.js">
<script>

</script>
</head>
<body class="wac git-home git">
<div class="header">
  <div class="container">
    <span class="k">k</span>
    <h1>Kikaha</h1>
    <a href="https://blog.kikaha.io">blog</a>
    <a href="https://github.com/Skullabs/kikaha">source code</a>
  </div>
</div>

<div class="page-wrap">
<div class="home-section home-about home-start">
<div class="g-row container">

<div class="g-column g-7-12 t-6-12 m-12-12">
<!-- CONTENT -->
<p>Kikaha has a very tiny and non-intrusive Security API written over Undertow's Security API. Basically it has a few components that together allow you to protect your resources. Let's checkout the main components you'll usually need to deal with:</p>
<ul>
<li><em>Authentication Rules</em>: will define how your web resources will be protected against unauthorized access.</li>
<li><em>Authentication Mechanisms</em>: defines how to extract credentials from the request when trying to authenticate.</li>
<li><em>Identity Manager</em>: defines how to check if found credentials are valid.</li>
<li><em>Session Store</em>: defines how to sessions are managed on the server.</li>
<li><em>Password Encoder</em>: defines how passwords are stored and matched.</li>
</ul>
<h2 id="authenticationrules">Authentication Rules</h2>
<pre><code>TODO
</code></pre>
<h2 id="authenticationmechanisms">Authentication Mechanisms</h2>
<p>Authentication mechanisms is responsible for extract credentials from HTTP requests. Usually they does not check if the credentials are valid, but delegates the validation to the IdentityManager defined on the matched Authentication Rule. Out-of-box only a few Authentication Mechanisms are provided. They are very common and allow developers to get started very quickly. Bellow they are listed and identified by its own <code>alias</code>:</p>
<ul>
<li><em>basic</em>: The implementation of Http's Basic Authentication.</li>
<li><em>form</em>: The Form-based authentication. It will enforce security by requiring user to provide their credentials through a HTML form.</li>
<li><em>json</em>: Will receive the credentials through a HTTP POST of a JSON object. This mechanism requires <a href="https://github.com/Skullabs/kikaha/tree/master/kikaha-modules/kikaha-jackson">kikaha-jackson</a> module.</li>
</ul>
<p>Now lets talk about its <em>alias</em>. All Authentication Mechanism should be defined on the configuration entry <code>server.auth.authentication-mechanisms</code> on a <code>alias: class.Name</code> form (see sample the configuration file bellow). The alias, as we discussed before, are used on the Authentication Rules and avoids you to repeat the Authentication Mechanism's Class Canonical Name every time you need to use it to protect a specific resource.</p>
<p>Here are a sample code with the default Authentication Mechanisms that comes out-of-box with Kikaha:</p>
<pre><code class="yml language-yml">server:
  auth:
    auth-mechanisms:

      # available on kikaha-core's module
      basic: kikaha.core.modules.security.BasicAuthenticationMechanism
      form: kikaha.core.modules.security.FormAuthenticationMechanism

      # available on kikaha-jackson's module
      json: kikaha.urouting.serializers.jackson.JSONAuthenticationMechanism
</code></pre>
<p>If none of the above described mechanisms fits your needs you can easily create your own by implementing the interface <code>kikaha.core.modules.security.AuthenticationMechanism</code> and defining an alias for it. Please, keep in mind that cood Authentication Mechanisms usually delegates the Credential Validation to a proper IdentityManager.</p>
<h2 id="identitymanagers">Identity Managers</h2>
<p>Identity Managers are responsible for ensure credentials are valid. Also, is its responsibility retrieve the <code>Account</code> and its <code>Roles</code> from the place you've stored your data. Out-of-box there a few Identity Managers available:</p>
<ul>
<li>"fixed": Uses a fixed username and password, defined on the configuration file, as the only valid credential</li>
<li>"db-auth": Uses a Database connection to validate credentials.</li>
</ul>
<p>, the only a <code>Fixed User and Password</code> identity manager is provided. It is a fast way to define a username and a password to authenticate a user while you are developing a software. A more sophisticated Identity Manager could be developed by implementing the <code>kikaha.core.modules.security.IdentityManager</code> interface. A much simpler approach is to extends <code>kikaha.core.modules.security.AbstractPasswordBasedIdentityManager</code>.</p>
<h3 id="customidentitymanager">Custom Identity Manager</h3>
<p>The code bellow illustrates how to create your own Identity Manager with fixed username and password. Developers are encouraged to follow this pattern to provide their own Identity Manager.</p>
<pre><code class="java language-java">package sample;
import kikaha.core.modules.security.*;

public class CustomIdentityManager extends AbstractPasswordBasedIdentityManager {

    final String username = "admin";
    final String password = "password";
    final String defaultRole = "admin";

    @Override
    public Account retrieveAccountFor( String id, String password ) {
        if ( this.username.equals( id ) &amp;&amp; this.password.equals( password ) )
            return new FixedUsernameAndRolesAccount( username, defaultRole );
        return null;
    }
}
</code></pre>
<p>Don't forget to register an alias to your custom Identity Manager.</p>
<pre><code class="yml language-yml">server:
  auth:
    identity-manager:
      custom: sample.CustomIdentityManager
</code></pre>
<h2 id="sessionstore">Session Store</h2>
<h2 id="passwordencoders">Password Encoders</h2>
<p>password-encoder: kikaha.core.modules.security.PlainTextPasswordEncoder</p>
<blockquote>
  <p><strong>Note:</strong> In order to use the <strong>distributed</strong> SecurityContextFactory you have to include the <code>kikaha-hazelcast</code> module. See more details at  <strong><a href="doc:hazelcast.html">Hazelcast</a></strong> documentation.</p>
  <p><strong>Note2:</strong> Both <em>SecurityContextFactory</em>s, <em>AuthenticationMechanism</em>s and <em>IdentityManager</em>s has to be <em>a managed class</em> in order to Kikaha load it correctly at the application startup. If you are not familiar with the <em>managed class</em> term, please take a look at the <strong><a href="doc:dependency-injection.html">Dependency Injection</a></strong> for more details.
  [block:api-header]
  {
    "type": "basic",
    "title": "Protecting resources"
  }
  [/block]
  To define that some web resources will requires authentication, you could include an entry in <code>server.auth.rules</code> array on your configuration file. It will behaves like <a href="http://en.wikipedia.org/wiki/Access_control_list">ACL</a> where the first rule that matches the request will be applied. If no rule was matched, then the route will be executed as non-authenticated resource. Bellow we defined a rule the require authentication for any request made at "/protected/" resource and its sub-locations.
  [block:code]
  {
    "codes": [
      {
        "code": "server:
	auth:
  	rules:
      - pattern: \"/protected/*\"
        identity-manager:
          - \"custom\"
        auth-mechanisms:
          - \"basic\"
        expected-roles:
        exclude-patterns:
",
        "language": "yaml",
        "name": "application.yml"
      }
    ]
  }
  [/block]
  As you can note, there is some attributes we can define to the rule:</p>
  <ul>
  <li>pattern: the unique mandatory attribute, it defines which resources will require authentication</li>
  <li>identity-manager: defines which Identity Manager will be used to match the sent credentials.</li>
  <li>mechanisms: defines which Authentication Mechanisms will used to extract credentials.</li>
  <li>expected-roles: (optional) which roles should the Identity Manager retrieves to authorize the access to resources protected by this rule.</li>
  <li>exclude-patterns: (optional) is an array of patters that should ignored during the authorization/authentication process. There is cases where is easier to map a more generalist pattern and define which URLs should be unconsidered on the authentication/authorization process. It may be also useful when you have more than one authentication rule.</li>
  </ul>
</blockquote>
<h2 id="configuringthefixeduserandpasswordidentitymanager">Configuring the Fixed User and Password Identity Manager</h2>
<p>If you opt to use the <em>Fixed User and Password Identity Manager</em>, you can set the expected username, password and role at <code>server.auth.fixed-auth</code> entry of your configuration file. You can find the default values <a href="doc:configuring-the-server.html">here</a>.
[block:code]
{
  "codes": [
    {
      "code": "server:
	auth:
		fixed-auth:
      username: \"admin\"
      password: \"admin\"
      role:
      	- \"admin\"",
      "language": "yaml",
      "name": "application.yml"
    }
  ]
}
[/block]</p>
<p>[block:api-header]
{
  "type": "basic",
  "title": "Configuring the Form Authentication Mechanism"
}
[/block]
Consider the bellow configuration.
[block:code]
{
  "codes": [
    {
      "code": "server:
	auth:
    rules:
      - pattern: \"/protected/*\"
        auth-'mechanisms:
					- \"form\"
        identity-manager:
					- \"default\"

    fixed-auth:
      username: \"admin\"
      password: \"1q2w3e\"
      role: \"admin\"

    form-auth:
      login-page: \"/auth/login.html\"
      error-page: \"/auth/error.html\"
      permition-denied-page: \"/auth/forbiden.html\"
",
      "language": "json",
      "name": "application.yml"
    }
  ]
}
[/block]
Here we've defined a set of configuration parameters related to Form Authentication. At the first block we which resources will be required authorization to access. Besides is impossible to set more than one Authentication Mechanism at once, we set only "form" to simplify our example.</p>
<p>As we defined the "default" identity-manager as our mechanism to validate the credentials sent by the HTTP client, we defined the username and password at the <code>fixed-auth</code> block. The last block, <code>form-auth</code> define which pages will be used during the authentication lifecycle:</p>
<ul>
<li><strong>login-page</strong>: the HTML page containing the form where users will be able to write its credentials</li>
<li><strong>error-page</strong>: the HTML page that will notificaty that the logging have failed</li>
<li><strong>permition-defined-page</strong>: the HTML page the will notify the user that the login was OK but he does not have permition (specific roles) to access the requested page.
[block:code]
{
"codes": [
{
  "code": "<!-- http://www.avajava.com/tutorials/lessons/how-do-i-use-form-authentication-with-tomcat.html -->
<form method=\"POST\" action=\"/protected/j_security_check\">
<table>
	<tr>
		<td colspan=\"2\">Login to the Demo application:</td>
	</tr>
	<tr>
		<td>Name:</td>
		<td><input type=\"text\" name=\"j_username\" /></td>
	</tr>
	<tr>
		<td>Password:</td>
		<td><input type=\"password\" name=\"j_password\"/ ></td>
	</tr>
	<tr>
		<td colspan=\"2\"><input type=\"submit\" value=\"Go\" /></td>
	</tr>
</table>
</form>",
  "language": "html",
  "name": "login.html"
}
]
}
[/block]
Above a sample <code>login.html</code>. Java developers will be at home here once it follows the same standard for form authentication defined by Servlet API:</li>
<li>The action must be placed inside the <em>protected</em> path and end with <em>j<em>security</em>check</em></li>
<li>The username field must be named <em>j_username</em> </li>
<li>The password field must be named <em>j_password</em>.</li>
</ul>
</div>

<div class="g-column g-4-12 t-6-12 m-12-12">
<div class="home-about--git-download-block">
<h3>Welcome</h3>
<!-- SIDE BAR -->
<p>WELCOME
<a href="About-kikaha.html">About</a>
<a href="Kikaha-Philosophy.html">Kikaha philosophy</a></p>
<p>GETTING STARTED
<a href="Getting-Started-in-1-Minute.html">Getting started in 1 minute</a>
<a href="Creating-a-Kikaha-maven-project.html">Creating a Kikaha maven project</a>
<a href="Architecture-Overview.html">Architecture overview</a></p>
<p>TUTORIALS
<a href="Logging-Configuration.html">Logging configuration</a>
<a href="Configuring-the-server.html">Configuring the server</a>
<a href="creating-your-first-http-route.html">Creating your first HTTP route</a>
<a href="kikahas-command-line-interface-tool.html">Kikaha's command line interface</a>
<a href="configuring-your-favorite-ide.html">Configuring your favorite IDE</a>
<a href="Kikaha-Wro4j-Integration.html">Wro4j Integration</a></p>
<p>CORE FEATURES
<a href="HTTP-and-HTTPS.html">HTTP and HTTPS</a>
<a href="Routing-static-assets.html">Routing static assets</a>
<a href="Dependency-Injection.html">Dependency injection</a>
<a href="Authentication-and-Authorization.html">Authentication and authorization</a>
<a href="Smart-Routes.html">Smart routes</a></p>
<p>ESSENTIAL MODULES
<a href="uRouting-API.html">μRouting API</a>
<a href="Web-Socket-routing.html">WebSocket Routing</a>
<a href="Database-Access.html">Database Connection Pool</a>
<a href="JSON-with-Jackson.html">JSON with Jackson</a>
<a href="Proto-Buffers.html">Protobuf</a>
<a href="Mustache.html">Mustache Templates</a>
<a href="Rocker-Templates.html">Rocker Templates</a>
<a href="BCrypt.html">BCrypt</a></p>
<p>CLOUD MODULES
<a href="Consul.io.html">Consul.io</a>
<a href="Codahale-Metrics.html">Codahale's Metrics</a>
<a href="Auth0.html">Auth0 Single Sign-On</a>
<a href="uWorkers.html">μWorkers - Actor-like API</a>
<a href="Hazelcast.html">Hazelcast</a></p>
<p>AWS-RELATED MODULES
<a href="AWS-Related-Modules.html">Overview of AWS-Related Modules</a>
<a href="Deploying-Applications-to-AWS.html">Deploying Applications on AWS</a>
<a href="AWS-IAM-Credentials.html">AWS IAM Credentials</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+EC2&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+EC2..html">AWS EC2</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+SQS+Queues&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+SQS+Queues..html">AWS SQS queues</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+CloudWatch+Metrics&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+CloudWatch+Metrics..html">AWS CloudWatch metrics</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+ALB&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+Load+Balacer..html">AWS Application Load Balancer</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+Lambda&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+Lambda+Functions..html">AWS Lambda functions</a>
<a href="https://github.com/Skullabs/kikaha/issues/new?labels=documentation&title=AWS+X-RAY&body=It+would+be+great+to+have+a+detailed+documentation+about+AWS+X-RAY..html">AWS X-Ray</a></p>
<p>ADVANCED TOPICS
<a href="Creating-Custom-Modules.html">Creating custom modules</a>
<a href="Routing-With-Undertow.html">Routing with Undertow's API</a>
<a href="Creating-Custom-Cloud-Modules.html">Creating custom cloud modules</a></p>
</div>
</div>

</div>
</div>
</div>
</body>
</html>
